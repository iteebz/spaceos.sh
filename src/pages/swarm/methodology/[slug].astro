---
import Prose from "../../../layouts/Prose.astro";
import fs from "node:fs";
import path from "node:path";
import { marked } from "marked";

export function getStaticPaths() {
  const methodologyDir = path.join(process.cwd(), "docs", "methodology");
  const files = fs.readdirSync(methodologyDir).filter((f) => f.endsWith(".md"));

  return files.map((file) => ({
    params: { slug: file.replace(".md", "") },
  }));
}

const { slug } = Astro.params;
const filePath = path.join(process.cwd(), "docs", "methodology", `${slug}.md`);
const content = fs.readFileSync(filePath, "utf-8");

const lines = content.split("\n");
const title = lines[0].replace(/^#\s*/, "");
const body = lines.slice(1).join("\n");
const html = await marked(body);
---

<Prose title={title} description="Coordination pattern">
  <nav class="mb-8">
    <a
      href="/swarm/methodology"
      class="text-white/60 hover:text-white text-sm no-underline"
      >&larr; All patterns</a
    >
  </nav>
  <h1>{title}</h1>
  <Fragment set:html={html} />
</Prose>
